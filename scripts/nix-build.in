#! @shell@ -e

nixExpr=$1

if test -z "$nixExpr"; then
    echo "syntax: $0 NIX-EXPR..." >&2
    exit 1
fi

extraArgs=

for i in "$@"; do
    case "$i" in
        -*)
            extraArgs="$extraArgs $i"
            ;;
        *)
            storeExpr=$(nix-instantiate "$i")
            for j in $storeExpr; do
                echo "store expression is $j" >&2
            done
            outPath=$(nix-store -qnfv $extraArgs $storeExpr)
            echo $outPath
            if test -e result; then
                if ! test -L result; then
                    echo "cannot remove \`result\' (not a symlink)"
                    exit 1
                fi
                rm result
            fi
            ln -s $outPath result
            ;;
    esac
done
