#! @shell@ -e

export PATH=/bin:/usr/bin

echo "downloading $url into $out"

prefetch=@storedir@/nix-prefetch-url-$md5
if test -f "$prefetch"; then
    echo "using prefetched $prefetch";
    mv $prefetch $out
else
    @curl@ --fail --location --max-redirs 20 "$url" > "$out"
fi

actual=$(@bindir@/nix-hash --flat $out)
if test "$actual" != "$md5"; then
    echo "hash is $actual, expected $md5"
    exit 1
fi
